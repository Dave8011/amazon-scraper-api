<!DOCTYPE html>
<html>
<head>
  <title>Amazon Scraper UI</title>
</head>
<body>
  <h2>Amazon Scraper Form</h2>
  <form id="scrape-form">
    <label>Company Name (optional): <input type="text" name="company"></label><br><br>

    <label>Enter Pincodes (comma-separated): <input type="text" name="pincodes"></label><br><br>

    <label>Upload ASIN CSV: <input type="file" id="asinFile" accept=".csv"></label><br><br>

    <label>Send Email? <input type="checkbox" name="sendMailFlag" id="sendMailCheckbox"></label><br><br>
    <label>Recipient Email: <input type="email" name="recipient_email" id="emailField" style="display:none;"></label><br><br>

    <label>Include Competitors? <input type="checkbox" name="getCompetitorFlag" checked></label><br><br>
    <label>Include Product Title? <input type="checkbox" name="getProductTitleFlag" checked></label><br><br>

    <!-- Additional toggles -->
    <label>Include Selling Price? <input type="checkbox" name="includePrice" checked></label><br><br>
    <label>Include Sellers Count? <input type="checkbox" name="includeSellerCount" checked></label><br><br>

    <button type="submit">Start Scraping</button>
  </form>

  <script>
    const form = document.getElementById('scrape-form');
    const checkbox = document.getElementById('sendMailCheckbox');
    const emailField = document.getElementById('emailField');
    const asinFileInput = document.getElementById('asinFile');

    checkbox.addEventListener('change', () => {
      emailField.style.display = checkbox.checked ? 'inline' : 'none';
    });

    // Helper to parse CSV (simple version)
    function parseCSV(text) {
      // Assumes ASIN is in first column, one per row
      return text.trim().split('\n').map(line => line.split(',')[0].trim());
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      let asinList = [];

      if (asinFileInput.files.length > 0) {
        const file = asinFileInput.files[0];
        const text = await file.text();
        asinList = parseCSV(text);
      }

      const pincodesList = form.pincodes.value ? form.pincodes.value.split(',').map(p => p.trim()) : [];

      const data = {
        company: form.company.value || "unknown",
        pincodes: pincodesList,
        asins: asinList, // send this to backend
        sendMailFlag: checkbox.checked,
        recipient_email: form.recipient_email.value || null,
        getCompetitorFlag: form.getCompetitorFlag.checked,
        getProductTitleFlag: form.getProductTitleFlag.checked,
        includePrice: form.includePrice.checked,
        includeSellerCount: form.includeSellerCount.checked
      };

      const response = await fetch('/scrape/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const result = await response.json();
      alert(result.message || "Scraping started!");
    });
  </script>
</body>
</html>
